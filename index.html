<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>üíú Bud Love Tickets</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icons/icon-192.svg">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a14;
      --bg-secondary: #1a1a2e;
      --bg-card: #1a1a2e;
      --bg-card-solid: #1a1a2e;
      --accent: #a855f7;
      --accent-light: #c084fc;
      --accent-glow: rgba(168, 85, 247, 0.4);
      --text-primary: #f0f0f5;
      --text-secondary: #8888aa;
      --text-muted: #555577;
      --border: rgba(255,255,255,0.08);
      --border-hover: rgba(168, 85, 247, 0.5);
      --success: #22c55e;
      --warning: #eab308;
      --info: #3b82f6;
      --pink: #ec4899;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    body {
      font-family: 'Space Grotesk', -apple-system, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* Header */
    .header {
      background: linear-gradient(180deg, #12122a 0%, var(--bg-primary) 100%);
      padding: 16px 16px 12px;
      border-bottom: 1px solid rgba(168, 85, 247, 0.25);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }
    
    .logo {
      font-size: 1.1em;
      font-weight: 600;
      color: #f5e6d0;
      white-space: nowrap;
    }
    
    /* Search */
    .search-container {
      flex: 1;
      max-width: 280px;
    }
    
    .search-input {
      width: 100%;
      padding: 8px 14px;
      border-radius: 20px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--text-primary);
      font-size: 0.85em;
      outline: none;
      transition: all 0.3s;
    }
    
    .search-input:focus {
      border-color: var(--accent);
      background: rgba(255,255,255,0.08);
    }
    
    .search-input::placeholder { color: var(--text-muted); }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 4px 0;
      scrollbar-width: none;
    }
    
    .tabs::-webkit-scrollbar { display: none; }
    
    .tab {
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 0.8em;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .tab:hover {
      background: rgba(255,255,255,0.1);
      color: #ccc;
      transform: translateY(-1px);
    }
    
    .tab.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
      box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
    }
    
    .tab .badge {
      background: rgba(255,255,255,0.2);
      padding: 1px 6px;
      border-radius: 10px;
      font-size: 0.75em;
      margin-left: 6px;
    }
    
    /* Content */
    .content {
      padding: 20px 16px;
      max-width: 800px;
      margin: 0 auto;
      animation: fadeIn 0.4s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    /* Stats Dashboard */
    .stats-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
      animation: slideIn 0.5s ease-out;
    }
    
    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      transition: all 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-3px);
      border-color: var(--border-hover);
    }
    
    .stat-value {
      font-size: 2em;
      font-weight: 700;
      color: var(--accent-light);
    }
    
    .stat-label {
      font-size: 0.75em;
      color: var(--text-secondary);
      margin-top: 4px;
    }
    
    /* Project Header */
    .project-header {
      text-align: center;
      margin-bottom: 24px;
      animation: scaleIn 0.4s ease-out;
    }
    
    .project-title {
      font-size: 1.4em;
      font-weight: 600;
      color: #fff;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .project-desc {
      color: var(--text-secondary);
      font-size: 0.9em;
    }
    
    .version-badge {
      background: rgba(170,51,51,0.2);
      color: var(--accent-light);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.65em;
      font-weight: 500;
    }
    
    .project-meta {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: center;
      margin-top: 8px;
      font-size: 0.8em;
      color: var(--text-muted);
    }
    
    /* Progress Bar */
    .progress-container {
      margin: 16px 0;
      padding: 12px 16px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
    }
    
    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.8em;
    }
    
    .progress-label { color: var(--text-secondary); }
    .progress-value { color: var(--accent-light); font-weight: 600; }
    
    .progress-bar {
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 100%);
      border-radius: 4px;
      transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Tree */
    .tree {
      position: relative;
      padding-left: 0;
    }
    
    .tree::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, var(--accent) 0%, rgba(170,51,51,0.2) 100%);
      transform: translateX(-50%);
    }
    
    /* Feature Card */
    .feature-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 18px;
      margin-bottom: 14px;
      position: relative;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      animation: slideIn 0.4s ease-out backwards;
    }
    
    .feature-card:nth-child(1) { animation-delay: 0.05s; }
    .feature-card:nth-child(2) { animation-delay: 0.1s; }
    .feature-card:nth-child(3) { animation-delay: 0.15s; }
    .feature-card:nth-child(4) { animation-delay: 0.2s; }
    .feature-card:nth-child(5) { animation-delay: 0.25s; }
    
    .feature-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-3px) scale(1.01);
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    }
    
    .feature-card.highlight {
      border-color: gold;
      box-shadow: 0 0 20px rgba(255,215,0,0.3);
    }
    
    .feature-card.dimmed {
      opacity: 0.3;
    }
    
    .feature-card::before {
      content: '';
      position: absolute;
      left: 50%;
      top: -9px;
      width: 12px;
      height: 12px;
      background: var(--accent);
      border-radius: 50%;
      transform: translateX(-50%);
      border: 2px solid var(--bg-primary);
      transition: all 0.3s;
    }
    
    .feature-card:hover::before {
      transform: translateX(-50%) scale(1.3);
    }
    
    .feature-title {
      font-size: 0.95em;
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .feature-icon { font-size: 1.1em; }
    
    .feature-desc {
      color: var(--text-secondary);
      font-size: 0.8em;
      line-height: 1.5;
    }
    
    .feature-tags {
      display: flex;
      gap: 6px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    
    .tag {
      background: rgba(170,51,51,0.2);
      color: var(--accent-light);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.65em;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .tag.highlight {
      background: rgba(255,215,0,0.3);
      color: gold;
    }
    
    .feature-date {
      font-size: 0.65em;
      color: var(--text-muted);
      margin-top: 6px;
    }
    
    .feature-note-indicator {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 0.8em;
    }
    
    /* All Projects Grid */
    .all-projects {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      padding: 20px 16px;
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .project-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      animation: scaleIn 0.4s ease-out backwards;
    }
    
    .project-card:nth-child(1) { animation-delay: 0.1s; }
    .project-card:nth-child(2) { animation-delay: 0.2s; }
    .project-card:nth-child(3) { animation-delay: 0.3s; }
    
    .project-card:hover {
      border-color: var(--accent);
      transform: translateY(-6px);
      box-shadow: 0 12px 36px rgba(0,0,0,0.4);
    }
    
    .project-card.highlight {
      border-color: gold;
      box-shadow: 0 0 30px rgba(255,215,0,0.3);
    }
    
    .project-card.dimmed {
      opacity: 0.3;
    }
    
    .project-card-title {
      font-size: 1.05em;
      font-weight: 600;
      color: #fff;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .project-card-desc {
      color: var(--text-secondary);
      font-size: 0.8em;
      margin-bottom: 12px;
      line-height: 1.4;
    }
    
    .project-card-stats {
      display: flex;
      gap: 12px;
      font-size: 0.7em;
      color: var(--text-muted);
      flex-wrap: wrap;
    }
    
    .stat {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    /* Cross-links indicator */
    .cross-links {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed rgba(255,255,255,0.1);
      font-size: 0.7em;
      color: var(--info);
    }
    
    .cross-link-tag {
      display: inline-block;
      background: rgba(33,150,243,0.2);
      padding: 2px 6px;
      border-radius: 4px;
      margin: 2px;
    }
    
    /* Timeline View */
    .timeline {
      position: relative;
      padding: 20px 16px;
      max-width: 900px;
      margin: 0 auto;
    }
    
    .timeline::before {
      content: '';
      position: absolute;
      left: 20px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, var(--accent) 0%, rgba(170,51,51,0.2) 100%);
    }
    
    @media (min-width: 600px) {
      .timeline::before { left: 50%; transform: translateX(-50%); }
    }
    
    .timeline-date {
      font-size: 0.85em;
      font-weight: 600;
      color: var(--accent-light);
      margin: 24px 0 12px 40px;
      position: relative;
    }
    
    @media (min-width: 600px) {
      .timeline-date { text-align: center; margin-left: 0; }
    }
    
    .timeline-item {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 16px;
      margin: 12px 0 12px 40px;
      position: relative;
      transition: all 0.3s;
      animation: slideIn 0.4s ease-out;
    }
    
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -28px;
      top: 14px;
      width: 10px;
      height: 10px;
      background: var(--accent);
      border-radius: 50%;
      border: 2px solid var(--bg-primary);
    }
    
    @media (min-width: 600px) {
      .timeline-item {
        width: 45%;
        margin-left: 0;
      }
      .timeline-item:nth-child(even) { margin-left: 55%; }
      .timeline-item::before {
        left: auto;
        right: -33px;
      }
      .timeline-item:nth-child(even)::before {
        left: -33px;
        right: auto;
      }
    }
    
    .timeline-item:hover {
      border-color: var(--border-hover);
      transform: translateX(5px);
    }
    
    .timeline-project {
      font-size: 0.7em;
      color: var(--accent-light);
      margin-bottom: 4px;
    }
    
    .timeline-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .timeline-desc {
      font-size: 0.8em;
      color: var(--text-secondary);
    }
    
    /* Cases View */
    .cases-grid {
      padding: 20px;
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .cases-header {
      text-align: center;
      margin-bottom: 24px;
    }
    
    .cases-header h2 {
      font-size: 1.5em;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--accent), var(--pink));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .cases-header p {
      color: var(--text-secondary);
    }
    
    .cases-list {
      display: flex;
      flex-direction: column;
      gap: 0;
    }
    
    .cases-table-header {
      display: grid;
      grid-template-columns: 180px 1fr 120px 80px;
      gap: 20px;
      padding: 12px 16px;
      font-size: 0.75em;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      font-weight: 600;
      border-bottom: 1px solid var(--border);
    }
    
    .case-row {
      display: grid;
      grid-template-columns: 180px 1fr 120px 80px;
      gap: 20px;
      padding: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      cursor: pointer;
      transition: all 0.3s ease;
      align-items: center;
      animation: fadeInUp 0.3s ease-out;
    }
    
    .case-row:hover {
      background: rgba(168, 85, 247, 0.08);
      border-color: rgba(168, 85, 247, 0.2);
    }
    
    .case-row .col-name {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .case-row .col-desc {
      color: var(--text-secondary);
      font-size: 0.9em;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .case-row .col-date {
      color: var(--text-muted);
      font-size: 0.85em;
    }
    
    .case-row .col-tickets {
      text-align: center;
    }
    
    .case-card-tickets {
      background: var(--accent);
      color: white;
      padding: 3px 10px;
      border-radius: 10px;
      font-size: 0.8em;
    }
    
    @media (max-width: 600px) {
      .cases-table-header {
        grid-template-columns: 1fr 80px 60px;
      }
      .cases-table-header .col-desc { display: none; }
      .case-row {
        grid-template-columns: 1fr 80px 60px;
      }
      .case-row .col-desc { display: none; }
    }
    
    /* Case Detail */
    .case-detail {
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .back-btn {
      background: none;
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 20px;
      transition: all 0.2s;
    }
    
    .back-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }
    
    .case-detail-header {
      margin-bottom: 24px;
    }
    
    .case-detail-title {
      font-size: 1.5em;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--accent), var(--pink));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .case-detail-desc {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 16px;
    }
    
    .case-features {
      margin-bottom: 24px;
    }
    
    .case-features h3 {
      margin-bottom: 12px;
      color: var(--text-primary);
    }
    
    .feature-item {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 14px;
      margin-bottom: 8px;
      color: var(--text-secondary);
      animation: fadeInUp 0.3s ease-out;
    }
    
    .case-create-btn {
      padding: 14px 24px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--pink) 100%);
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .case-create-btn:hover {
      transform: scale(1.03) translateY(-2px);
      box-shadow: 0 8px 20px var(--accent-glow);
    }
    
    .case-tickets-section {
      margin-top: 24px;
    }
    
    .case-tickets-section h3 {
      margin-bottom: 12px;
    }

    /* Kanban / Tickets View */
    .kanban {
      display: flex;
      gap: 16px;
      padding: 16px;
      overflow-x: auto;
      min-height: 70vh;
    }
    
    @media (max-width: 600px) {
      .kanban { flex-direction: column; }
    }
    
    .kanban-column {
      flex: 1;
      min-width: 300px;
      background: rgba(255,255,255,0.02);
      border-radius: 16px;
      padding: 16px;
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }
    
    .kanban-column:hover {
      border-color: rgba(168, 85, 247, 0.15);
    }
    
    .kanban-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 4px 16px;
      margin-bottom: 12px;
    }
    
    .kanban-header h3 {
      margin: 0;
      font-size: 0.85em;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .kanban-count {
      background: var(--accent);
      color: #fff;
      padding: 2px 9px;
      border-radius: 10px;
      font-size: 0.75em;
      font-weight: 600;
      min-width: 22px;
      text-align: center;
    }
    
    .kanban-cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 100px;
    }
    
    /* Done column: scrollable when tall */
    .kanban-column[data-status="done"] .kanban-cards {
      max-height: 600px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(168, 85, 247, 0.35) transparent;
    }
    
    .kanban-column[data-status="done"] .kanban-cards::-webkit-scrollbar {
      width: 5px;
    }
    
    .kanban-column[data-status="done"] .kanban-cards::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .kanban-column[data-status="done"] .kanban-cards::-webkit-scrollbar-thumb {
      background: rgba(168, 85, 247, 0.35);
      border-radius: 10px;
    }
    
    .kanban-column[data-status="done"] .kanban-cards::-webkit-scrollbar-thumb:hover {
      background: rgba(168, 85, 247, 0.55);
    }
    
    .done-completed-label {
      font-size: 0.72em;
      color: var(--text-muted);
      font-weight: 500;
      padding: 0 2px 8px;
    }
    
    .kanban-card {
      background: var(--bg-card-solid);
      border: 1px solid rgba(255,255,255,0.06);
      border-left: 3px solid rgba(255,255,255,0.04);
      border-radius: 12px;
      padding: 16px;
      cursor: grab;
      transition: all 0.2s ease;
      animation: fadeInUp 0.4s ease-out;
      position: relative;
    }
    
    .kanban-card:hover {
      border-color: rgba(168, 85, 247, 0.3);
      border-left-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(168, 85, 247, 0.15), 0 8px 20px rgba(0,0,0,0.3);
    }
    
    .kanban-card.dragging {
      opacity: 0.5;
      transform: rotate(3deg);
    }
    
    /* Card top row: ID + priority + menu */
    .kanban-card-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .kanban-card-top-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .kanban-card-id {
      font-size: 0.72em;
      font-weight: 500;
      color: var(--text-muted);
      letter-spacing: 0.3px;
    }
    
    .kanban-card-menu {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.4em;
      cursor: pointer;
      padding: 2px 8px;
      border-radius: 6px;
      transition: all 0.2s;
      line-height: 1;
      opacity: 0.4;
      font-weight: 700;
      letter-spacing: 1px;
    }
    
    .kanban-card:hover .kanban-card-menu {
      opacity: 1;
    }
    
    .kanban-card-menu:hover {
      background: rgba(255,255,255,0.1);
      color: var(--text-primary);
    }
    
    /* Card menu dropdown */
    .card-menu-dropdown {
      position: absolute;
      top: 42px;
      right: 12px;
      background: #1a1a2e;
      border: 1px solid rgba(168, 85, 247, 0.25);
      border-radius: 10px;
      padding: 4px;
      z-index: 999;
      min-width: 160px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05);
      display: none;
    }
    
    .card-menu-dropdown.active {
      display: block;
      animation: scaleIn 0.15s ease-out;
    }
    
    .card-menu-item {
      display: block;
      width: 100%;
      padding: 9px 14px;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 0.82em;
      font-family: inherit;
      cursor: pointer;
      text-align: left;
      border-radius: 6px;
      transition: all 0.15s;
    }
    
    .card-menu-item:hover {
      background: rgba(168, 85, 247, 0.15);
      color: var(--text-primary);
    }
    
    .card-menu-item.danger {
      color: #ef4444;
    }
    
    .card-menu-item.danger:hover {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
    }
    
    .kanban-card-title {
      font-weight: 600;
      font-size: 1em;
      margin-bottom: 6px;
      color: #fff;
      line-height: 1.4;
    }
    
    .kanban-card-desc {
      font-size: 0.82em;
      color: var(--text-secondary);
      margin-bottom: 10px;
      line-height: 1.5;
    }
    
    /* Category tag pill */
    .kanban-card-category {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.7em;
      font-weight: 500;
      color: var(--text-secondary);
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.03);
      margin-bottom: 12px;
    }
    
    /* Card footer */
    .kanban-card-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 4px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.05);
    }
    
    .kanban-card-footer-left {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 0.72em;
      color: var(--text-muted);
    }
    
    .kanban-card-footer-item {
      display: flex;
      align-items: center;
      gap: 3px;
    }
    
    .kanban-card-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--accent);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65em;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    
    .kanban-card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75em;
      color: var(--text-muted);
    }
    
    .kanban-card-actions {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .delete-btn {
      background: none;
      border: none;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s;
      font-size: 0.9em;
      padding: 2px;
    }
    
    .kanban-card:hover .delete-btn {
      opacity: 0.6;
    }
    
    .delete-btn:hover {
      opacity: 1 !important;
    }
    
    .kanban-card-move {
      display: flex;
      gap: 4px;
    }
    
    .move-btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 6px;
      color: var(--text-muted);
      cursor: pointer;
      padding: 3px 10px;
      font-size: 0.8em;
      transition: all 0.2s;
    }
    
    .move-btn:hover {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }
    
    .kanban-card-priority {
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 0.68em;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }
    
    .priority-high { background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
    .priority-medium { background: rgba(245, 158, 11, 0.15); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3); }
    .priority-low { background: rgba(59, 130, 246, 0.15); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
    
    .kanban-add {
      width: 100%;
      padding: 12px;
      margin-top: 12px;
      background: rgba(255,255,255,0.02);
      border: 1px dashed rgba(255,255,255,0.1);
      border-radius: 10px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      font-size: 0.85em;
    }
    
    .kanban-add:hover {
      border-color: var(--accent);
      color: var(--accent-light);
      background: rgba(168, 85, 247, 0.06);
    }
    
    .share-bud-btn {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    
    .share-bud-btn:hover {
      transform: scale(1.03) translateY(-2px);
      box-shadow: 0 8px 20px rgba(168, 85, 247, 0.4);
    }
    
    .share-bud-btn:active {
      transform: scale(0.98);
    }
    
    .drop-zone {
      border: 2px dashed var(--accent);
      background: rgba(170,51,51,0.1);
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(4px);
      z-index: 200;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.2s ease-out;
    }
    
    .modal-overlay.active { display: flex; }
    
    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      animation: scaleIn 0.3s ease-out;
    }
    
    .modal-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5em;
      cursor: pointer;
      padding: 4px;
      line-height: 1;
    }
    
    .modal-close:hover { color: var(--text-primary); }
    
    .modal-body { padding: 20px; }
    
    /* Ticket Form */
    .ticket-modal { max-width: 400px; }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group label {
      display: block;
      font-size: 0.85em;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-secondary);
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.95em;
      font-family: inherit;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .priority-toggle {
      display: flex;
      gap: 8px;
    }
    
    .priority-btn {
      flex: 1;
      padding: 8px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.85em;
    }
    
    .priority-btn:hover {
      border-color: var(--accent);
    }
    
    .priority-btn.active[data-priority="low"] {
      background: #06d6a0;
      border-color: #06d6a0;
      color: #222;
    }
    
    .priority-btn.active[data-priority="medium"] {
      background: #ffd166;
      border-color: #ffd166;
      color: #222;
    }
    
    .priority-btn.active[data-priority="high"] {
      background: #ef476f;
      border-color: #ef476f;
      color: white;
    }
    
    .submit-btn {
      width: 100%;
      padding: 12px;
      background: var(--accent);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .submit-btn:hover {
      background: var(--accent-light);
    }
    
    .category-select {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.95em;
      cursor: pointer;
    }
    
    .category-select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .modal-section {
      margin-bottom: 16px;
    }
    
    .modal-section-title {
      font-size: 0.75em;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }
    
    .modal-desc {
      color: var(--text-secondary);
      font-size: 0.9em;
      line-height: 1.6;
    }
    
    /* Notes Section */
    .notes-section {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    
    .notes-list {
      margin-bottom: 12px;
    }
    
    .note-item {
      background: rgba(255,255,255,0.03);
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 0.85em;
    }
    
    .note-text { margin-bottom: 4px; }
    
    .note-date {
      font-size: 0.75em;
      color: var(--text-muted);
    }
    
    .note-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--text-primary);
      font-size: 0.85em;
      resize: none;
      outline: none;
      min-height: 60px;
    }
    
    .note-input:focus {
      border-color: var(--accent);
    }
    
    .note-submit {
      margin-top: 8px;
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      background: var(--accent);
      color: #fff;
      font-size: 0.85em;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .note-submit:hover {
      background: var(--accent-light);
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      padding: 12px 20px;
      border-radius: 12px;
      font-size: 0.85em;
      z-index: 300;
      transition: transform 0.3s ease-out;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    }
    
    .toast.show {
      transform: translateX(-50%) translateY(0);
    }
    
    /* Hidden */
    .hidden { display: none !important; }
    
    /* Footer */
    .footer {
      text-align: center;
      padding: 24px 20px;
      color: var(--text-muted);
      font-size: 0.7em;
    }
    
    /* Keyboard navigation */
    .feature-card:focus,
    .project-card:focus,
    .tab:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    /* Offline indicator */
    .offline-banner {
      background: var(--warning);
      color: #000;
      text-align: center;
      padding: 8px;
      font-size: 0.8em;
      font-weight: 500;
      display: none;
    }
    
    .offline-banner.show { display: block; }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }
    
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ===== IDEAS VIEW ===== */
    .ideas-container {
      padding: 20px 16px;
      max-width: 900px;
      margin: 0 auto;
    }

    .ideas-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .ideas-header h2 {
      font-size: 1.5em;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--accent), #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .ideas-header p {
      color: var(--text-secondary);
    }

    .ideas-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .ideas-sort {
      display: flex;
      align-items: center;
    }
    .ideas-filters {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .idea-filter-btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.78em;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }

    .idea-filter-btn:hover {
      background: rgba(255,255,255,0.1);
      color: #ccc;
    }

    .idea-filter-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
      box-shadow: 0 2px 8px rgba(168, 85, 247, 0.3);
    }

    .new-idea-btn {
      padding: 8px 18px;
      background: linear-gradient(135deg, var(--accent) 0%, #60a5fa 100%);
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      font-size: 0.85em;
      cursor: pointer;
      transition: all 0.3s;
      font-family: inherit;
      white-space: nowrap;
    }

    .new-idea-btn:hover {
      transform: scale(1.03) translateY(-2px);
      box-shadow: 0 6px 16px rgba(168, 85, 247, 0.4);
    }

    .ideas-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    @media (max-width: 600px) {
      .ideas-grid {
        grid-template-columns: 1fr;
      }
      .ideas-toolbar {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }
      .ideas-filters {
        flex-wrap: wrap;
        gap: 6px;
      }
      .ideas-sort {
        justify-content: flex-start;
      }
      .ideas-sort select {
        flex: 1;
      }
      .new-idea-btn {
        align-self: flex-end;
      }
    }

    .idea-card {
      --card-accent: 168,85,247;
      background: var(--bg-card-solid);
      border: 1px solid rgba(255,255,255,0.06);
      border-left: 3px solid rgba(var(--card-accent),0.35);
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      animation: fadeInUp 0.4s ease-out;
      position: relative;
      overflow: hidden;
    }

    .idea-card-accent {
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, rgba(var(--card-accent),0.8), rgba(var(--card-accent),0.1));
    }

    .idea-card:hover {
      border-color: rgba(var(--card-accent), 0.4);
      border-left-color: rgba(var(--card-accent), 0.8);
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(var(--card-accent), 0.15), 0 8px 20px rgba(0,0,0,0.3);
    }

    .idea-card-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .idea-status-badge {
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.68em;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .idea-status-brainstorming { background: rgba(168, 85, 247, 0.2); color: #c084fc; border: 1px solid rgba(168, 85, 247, 0.35); }
    .idea-status-planned { background: rgba(59, 130, 246, 0.2); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.35); }
    .idea-status-building { background: rgba(245, 158, 11, 0.2); color: #fbbf24; border: 1px solid rgba(245, 158, 11, 0.35); }
    .idea-status-shipped { background: rgba(34, 197, 94, 0.2); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.35); }

    .idea-card-menu {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.4em;
      cursor: pointer;
      padding: 2px 8px;
      border-radius: 6px;
      transition: all 0.2s;
      line-height: 1;
      opacity: 0.4;
      font-weight: 700;
      letter-spacing: 1px;
    }

    .idea-card:hover .idea-card-menu { opacity: 1; }

    .idea-card-menu:hover {
      background: rgba(255,255,255,0.1);
      color: var(--text-primary);
    }

    .idea-menu-dropdown {
      position: absolute;
      top: 42px;
      right: 12px;
      background: #1a1a2e;
      border: 1px solid rgba(168, 85, 247, 0.25);
      border-radius: 10px;
      padding: 4px;
      z-index: 999;
      min-width: 140px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05);
      display: none;
    }

    .idea-menu-dropdown.active {
      display: block;
      animation: scaleIn 0.15s ease-out;
    }

    .idea-card-title {
      font-weight: 600;
      font-size: 1em;
      margin-bottom: 6px;
      color: #fff;
      line-height: 1.4;
    }

    .idea-card-desc {
      font-size: 0.82em;
      color: var(--text-secondary);
      margin-bottom: 10px;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .idea-card-desc.expanded {
      -webkit-line-clamp: unset;
      overflow: visible;
    }

    .idea-card-tags {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .idea-tag {
      background: rgba(168, 85, 247, 0.15);
      color: var(--accent-light);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.65em;
      font-weight: 500;
    }

    .idea-card-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,0.05);
      font-size: 0.72em;
      color: var(--text-muted);
    }

    .idea-card-category {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 20px;
      font-size: 0.7em;
      font-weight: 500;
      color: var(--text-secondary);
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.03);
    }

    /* Expanded idea card */
    .idea-card.expanded {
      grid-column: 1 / -1;
      border-color: var(--accent);
      box-shadow: 0 0 30px rgba(168, 85, 247, 0.2);
    }

    .idea-card.expanded .idea-card-desc {
      -webkit-line-clamp: unset;
      overflow: visible;
    }

    .idea-inline-edit {
      display: none;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .idea-card.expanded .idea-inline-edit {
      display: block;
    }

    .idea-inline-edit .form-group {
      margin-bottom: 12px;
    }

    .idea-inline-edit .form-group input,
    .idea-inline-edit .form-group textarea,
    .idea-inline-edit .form-group select {
      width: 100%;
      padding: 8px 10px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.9em;
      font-family: inherit;
    }

    .idea-inline-edit .form-group input:focus,
    .idea-inline-edit .form-group textarea:focus,
    .idea-inline-edit .form-group select:focus {
      outline: none;
      border-color: var(--accent);
    }

    .idea-inline-edit .form-group label {
      display: block;
      font-size: 0.78em;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text-secondary);
    }

    .idea-save-btn {
      padding: 8px 16px;
      background: var(--accent);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 0.85em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
      margin-right: 8px;
    }

    .idea-save-btn:hover { background: var(--accent-light); }

    .idea-cancel-btn {
      padding: 8px 16px;
      background: none;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.85em;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }

    .idea-cancel-btn:hover { border-color: var(--accent); color: var(--accent); }

    /* ===== IDEA INNER TABS ===== */
    .idea-inner-tabs {
      display: flex;
      gap: 4px;
      margin: 10px 0 14px;
      padding-bottom: 0;
    }

    .idea-inner-tab {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 0.78em;
      font-weight: 500;
      cursor: pointer;
      padding: 4px 10px 8px;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      font-family: inherit;
    }

    .idea-inner-tab:hover {
      color: var(--text-secondary);
    }

    .idea-inner-tab.active {
      color: var(--accent-light);
      border-bottom-color: var(--accent);
    }

    .idea-tab-content {
      min-height: 80px;
    }

    /* Plan Phases */
    .plan-phases {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .plan-phase {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      transition: opacity 0.2s;
    }

    .plan-phase:last-child {
      border-bottom: none;
    }

    .plan-phase.done {
      opacity: 0.5;
    }

    .plan-phase.done .plan-phase-name {
      text-decoration: line-through;
      color: var(--text-muted);
    }

    .plan-phase.done .plan-phase-desc {
      text-decoration: line-through;
    }

    .plan-phase-check {
      margin-top: 2px;
      width: 18px;
      height: 18px;
      accent-color: var(--accent);
      cursor: pointer;
      flex-shrink: 0;
    }

    .plan-phase-content {
      flex: 1;
      min-width: 0;
    }

    .plan-phase-name {
      font-weight: 600;
      font-size: 0.88em;
      color: var(--text-primary);
      cursor: pointer;
      line-height: 1.4;
    }

    .plan-phase-name:hover {
      color: var(--accent-light);
    }

    .plan-phase-desc {
      font-size: 0.78em;
      color: var(--text-muted);
      line-height: 1.4;
      margin-top: 2px;
      cursor: pointer;
    }

    .plan-phase-desc:hover {
      color: var(--text-secondary);
    }

    .plan-phase-delete {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.85em;
      padding: 2px 6px;
      border-radius: 4px;
      opacity: 0;
      transition: all 0.15s;
      flex-shrink: 0;
    }

    .plan-phase:hover .plan-phase-delete {
      opacity: 0.6;
    }

    .plan-phase-delete:hover {
      opacity: 1 !important;
      color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }

    .plan-add-btn {
      margin-top: 10px;
      padding: 8px 14px;
      background: rgba(255,255,255,0.03);
      border: 1px dashed rgba(255,255,255,0.1);
      border-radius: 8px;
      color: var(--text-muted);
      font-size: 0.8em;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
      width: 100%;
      text-align: left;
    }

    .plan-add-btn:hover {
      border-color: var(--accent);
      color: var(--accent-light);
      background: rgba(168, 85, 247, 0.06);
    }

    /* Inline edit for phase name/desc */
    .plan-phase-edit-input {
      width: 100%;
      padding: 4px 8px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--accent);
      border-radius: 4px;
      color: var(--text-primary);
      font-size: inherit;
      font-family: inherit;
      font-weight: inherit;
      outline: none;
    }

    /* Notes textarea in idea */
    .idea-notes-area {
      width: 100%;
      min-height: 120px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.85em;
      font-family: inherit;
      resize: vertical;
      outline: none;
      line-height: 1.6;
    }

    .idea-notes-area:focus {
      border-color: var(--accent);
      background: rgba(255,255,255,0.05);
    }

    .idea-notes-saved {
      font-size: 0.7em;
      color: var(--text-muted);
      margin-top: 6px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .idea-notes-saved.visible {
      opacity: 1;
    }

    /* Idea Modal */
    .idea-modal { max-width: 480px; }

    .idea-modal textarea {
      min-height: 100px;
      resize: vertical;
    }

    .idea-status-select {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.95em;
      cursor: pointer;
      font-family: inherit;
    }

    .idea-status-select:focus {
      outline: none;
      border-color: var(--accent);
    }
  </style>
</head>
<body>
  <div class="offline-banner" id="offlineBanner">üì¥ You're offline - viewing cached data</div>
  
  <div class="header">
    <div class="header-top">
      <div class="logo">üíú Bud Love Tickets</div>
      <div class="search-container">
        <input type="text" class="search-input" id="searchInput" placeholder="Search..." autocomplete="off">
      </div>
    </div>
    <div class="tabs" id="tabs">
      <button class="tab active" data-project="tickets" tabindex="0">üé´ Tickets</button>
      <button class="tab" data-project="cases" tabindex="0">üìÅ Cases</button>
      <button class="tab" data-project="ideas" tabindex="0">üí° Ideas</button>
    </div>
  </div>
  
  <div id="loadingView" class="loading">
    <div class="loading-spinner"></div>
    <p style="margin-top: 16px">Loading evidence...</p>
  </div>
  
  <div id="allView" class="hidden">
    <div class="content">
      <div class="stats-dashboard" id="statsDashboard"></div>
    </div>
    <div class="all-projects" id="projectsGrid"></div>
  </div>
  
  <div id="projectView" class="content hidden"></div>
  
  <div id="timelineView" class="timeline hidden"></div>
  
  <div id="ticketsView" class="kanban hidden">
    <div class="kanban-column" data-status="todo">
      <div class="kanban-header">
        <h3>üìã To Do</h3>
        <span class="kanban-count" id="todoCount">0</span>
      </div>
      <div class="kanban-cards" id="todoCards"></div>
      <button class="kanban-add" onclick="addTicket('todo')">+ Add ticket</button>
    </div>
    <div class="kanban-column" data-status="doing">
      <div class="kanban-header">
        <h3>üî® Doing</h3>
        <span class="kanban-count" id="doingCount">0</span>
      </div>
      <div class="kanban-cards" id="doingCards"></div>
      <button class="kanban-add" onclick="addTicket('doing')">+ Add ticket</button>
    </div>
    <div class="kanban-column" data-status="done">
      <div class="kanban-header">
        <h3>‚úÖ Done</h3>
        <span class="kanban-count" id="doneCount">0</span>
      </div>
      <div class="kanban-cards" id="doneCards"></div>
      <button class="kanban-add" onclick="addTicket('done')">+ Add ticket</button>
    </div>
  </div>
  
  <!-- Cases View -->
  <div id="casesView" class="cases-grid hidden">
    <div class="cases-header">
      <h2>üìÅ Our Cases</h2>
      <p>Projects we've built together</p>
    </div>
    <div id="casesList" class="cases-list"></div>
  </div>
  
  <!-- Case Detail View -->
  <div id="caseDetailView" class="case-detail hidden">
    <button class="back-btn" onclick="navigateToView('cases')">‚Üê Back to Cases</button>
    <div id="caseDetailContent"></div>
  </div>

  <!-- Ideas View -->
  <div id="ideasView" class="ideas-container hidden">
    <div class="ideas-header">
      <h2>üí° Ideas Lab</h2>
      <p>Future projects and wild concepts</p>
    </div>
    <div class="ideas-toolbar">
      <div class="ideas-filters" id="ideasFilters">
        <button class="idea-filter-btn active" data-filter="all">All</button>
        <button class="idea-filter-btn" data-filter="brainstorming">üí≠ Brainstorming</button>
        <button class="idea-filter-btn" data-filter="planned">üìã Planned</button>
        <button class="idea-filter-btn" data-filter="building">üî® Building</button>
        <button class="idea-filter-btn" data-filter="shipped">üöÄ Shipped</button>
      </div>
      <div class="ideas-sort" id="ideasSort">
        <label style="color:var(--text-muted);font-size:0.85em;margin-right:6px;">Sort:</label>
        <select id="ideaSortSelect" onchange="changeIdeaSort(this.value)" style="background:var(--bg-primary);color:var(--text-primary);border:1px solid var(--border);border-radius:8px;padding:4px 10px;font-family:inherit;font-size:0.85em;cursor:pointer;">
          <option value="time-desc">üïê Newest</option>
          <option value="time-asc">üïê Oldest</option>
          <option value="title-asc">üî§ A-Z</option>
          <option value="title-desc">üî§ Z-A</option>
          <option value="status">üìä Status</option>
        </select>
      </div>
      <button class="new-idea-btn" onclick="openNewIdeaModal()">+</button>
    </div>
    <div class="ideas-grid" id="ideasGrid"></div>
  </div>

  <!-- Idea Modal -->
  <div class="modal-overlay" id="ideaModalOverlay">
    <div class="modal idea-modal">
      <div class="modal-header">
        <div class="modal-title" id="ideaModalTitle">üí° New Idea</div>
        <button class="modal-close" onclick="closeIdeaModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="ideaForm" onsubmit="submitIdea(event)">
          <input type="hidden" id="ideaEditId" value="">
          <div class="form-group">
            <label for="ideaTitle">Title</label>
            <input type="text" id="ideaTitle" placeholder="What's the big idea?" required>
          </div>
          <div class="form-group">
            <label for="ideaDesc">Description</label>
            <textarea id="ideaDesc" placeholder="Describe the vision... what does it do? why is it cool?" rows="5"></textarea>
          </div>
          <div class="form-group">
            <label for="ideaCategory">Category</label>
            <input type="text" id="ideaCategory" placeholder="e.g. MCP, UI, Tool">
          </div>
          <div class="form-group">
            <label for="ideaTags">Tags (comma separated)</label>
            <input type="text" id="ideaTags" placeholder="e.g. webapp, ai, creative">
          </div>
          <div class="form-group">
            <label for="ideaStatus">Status</label>
            <select id="ideaStatus" class="idea-status-select">
              <option value="brainstorming">üí≠ Brainstorming</option>
              <option value="planned">üìã Planned</option>
              <option value="building">üî® Building</option>
              <option value="shipped">üöÄ Shipped</option>
            </select>
          </div>
          <button type="submit" class="submit-btn">Create Idea</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Ticket Modal -->
  <div class="modal-overlay" id="ticketModalOverlay">
    <div class="modal ticket-modal">
      <div class="modal-header">
        <div class="modal-title">üé´ New Ticket</div>
        <button class="modal-close" onclick="closeTicketModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="ticketForm" onsubmit="submitTicket(event)">
          <input type="hidden" id="ticketStatus" value="todo">
          
          <div class="form-group">
            <label for="ticketTitle">Title</label>
            <input type="text" id="ticketTitle" placeholder="What needs to be done?" required>
          </div>
          
          <div class="form-group">
            <label for="ticketDesc">Description</label>
            <textarea id="ticketDesc" placeholder="Optional details..." rows="3"></textarea>
          </div>
          
          <div class="form-group">
            <label>Priority</label>
            <div class="priority-toggle">
              <button type="button" class="priority-btn" data-priority="low">Low</button>
              <button type="button" class="priority-btn active" data-priority="medium">Medium</button>
              <button type="button" class="priority-btn" data-priority="high">High</button>
            </div>
          </div>
          
          <div class="form-group">
            <label for="ticketCategory">Category</label>
            <select id="ticketCategory" class="category-select">
              <option value="general">üåê General</option>
            </select>
          </div>
          
          <button type="submit" class="submit-btn">Create Ticket</button>
        </form>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle"></div>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>
  
  <div class="footer">Built together ‚Ä¢ PWA enabled ‚Ä¢ Real-time sync</div>

  <script>
    // ===== STATE =====
    let state = {
      projects: {},
      allFeatures: [],
      stats: {},
      crossLinks: [],
      achievements: [],
      currentView: 'all',
      currentProject: null,
      searchQuery: '',
      focusIndex: -1
    };
    
    // ===== PWA =====
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('‚úÖ Service Worker registered'))
        .catch(err => console.log('‚ùå SW registration failed:', err));
    }
    
    window.addEventListener('online', () => {
      document.getElementById('offlineBanner').classList.remove('show');
      loadData();
    });
    
    window.addEventListener('offline', () => {
      document.getElementById('offlineBanner').classList.add('show');
    });
    
    // ===== URL STATE =====
    function updateURL() {
      const params = new URLSearchParams();
      if (state.currentView !== 'all') params.set('view', state.currentView);
      if (state.currentProject) params.set('project', state.currentProject);
      if (state.searchQuery) params.set('q', state.searchQuery);
      
      const newURL = params.toString() ? `?${params.toString()}` : window.location.pathname;
      history.replaceState(null, '', newURL);
    }
    
    function loadURLState() {
      const params = new URLSearchParams(window.location.search);
      if (params.get('q')) {
        state.searchQuery = params.get('q');
        document.getElementById('searchInput').value = state.searchQuery;
      }
      if (params.get('view')) state.currentView = params.get('view');
      if (params.get('project')) state.currentProject = params.get('project');
    }
    
    function shareURL() {
      const url = window.location.href;
      if (navigator.share) {
        navigator.share({ title: 'Bud Love Tickets', url });
      } else if (navigator.clipboard) {
        navigator.clipboard.writeText(url);
        showToast('üîó Link copied to clipboard!');
      }
    }
    
    // ===== DATA LOADING =====
    async function loadData() {
      // Static version - no backend needed
      state.projects = {};
      state.allFeatures = [];
      state.stats = { totalProjects: 0, totalFeatures: 0 };
      state.crossLinks = [];
      state.achievements = [];
      
      document.getElementById('loadingView').classList.add('hidden');
      initTabs();
      
      // Default to tickets view
      state.currentView = 'tickets';
      loadTickets();
      navigateToView('tickets');
    }
    
    // ===== WEBSOCKET (disabled for static) =====
    function connectWebSocket() {
      // Disabled for static hosting
      return;
      
      ws.onmessage = (e) => {
        const data = JSON.parse(e.data);
        if (data.type === 'refresh') {
          showToast('üîÑ Evidence updated!');
          loadData();
        } else if (data.type === 'tickets') {
          tickets = data.data;
          if (state.currentView === 'tickets') {
            renderTickets();
          }
        }
      };
      
      ws.onclose = () => {
        setTimeout(connectWebSocket, 3000);
      };
    }
    
    // ===== TABS =====
    function initTabs() {
      const tabsContainer = document.getElementById('tabs');
      
      // Click handlers
      tabsContainer.addEventListener('click', (e) => {
        const tab = e.target.closest('.tab');
        if (tab) {
          const project = tab.dataset.project;
          if (project === 'timeline') {
            navigateToView('timeline');
          } else if (project === 'tickets') {
            navigateToView('tickets');
          } else if (project === 'cases') {
            navigateToView('cases');
          } else if (project === 'ideas') {
            navigateToView('ideas');
          } else if (project === 'all') {
            navigateToView('all');
          }
        }
      });
    }
    
    function navigateToView(view, project = null) {
      state.currentView = view;
      state.currentProject = project;
      
      // Update tabs
      document.querySelectorAll('.tab').forEach(t => {
        const isActive = (view === 'project' && t.dataset.project === project) ||
                        (view === 'all' && t.dataset.project === 'all') ||
                        (view === 'timeline' && t.dataset.project === 'timeline') ||
                        (view === 'tickets' && t.dataset.project === 'tickets') ||
                        (view === 'cases' && t.dataset.project === 'cases') ||
                        (view === 'ideas' && t.dataset.project === 'ideas');
        t.classList.toggle('active', isActive);
      });
      
      // Hide all views
      document.getElementById('allView').classList.add('hidden');
      document.getElementById('projectView').classList.add('hidden');
      document.getElementById('timelineView').classList.add('hidden');
      document.getElementById('ticketsView').classList.add('hidden');
      document.getElementById('casesView').classList.add('hidden');
      document.getElementById('caseDetailView').classList.add('hidden');
      document.getElementById('ideasView').classList.add('hidden');
      
      // Show appropriate view
      if (view === 'all') {
        document.getElementById('allView').classList.remove('hidden');
        renderAllProjects();
      } else if (view === 'timeline') {
        document.getElementById('timelineView').classList.remove('hidden');
        renderTimeline();
      } else if (view === 'tickets') {
        document.getElementById('ticketsView').classList.remove('hidden');
        renderTickets();
      } else if (view === 'cases') {
        document.getElementById('casesView').classList.remove('hidden');
        renderCases();
      } else if (view === 'ideas') {
        document.getElementById('ideasView').classList.remove('hidden');
        renderIdeas();
      } else if (view === 'caseDetail' && project) {
        document.getElementById('caseDetailView').classList.remove('hidden');
        renderCaseDetail(project);
      } else if (view === 'project' && project) {
        document.getElementById('projectView').classList.remove('hidden');
        renderProject(project);
      }
      
      updateURL();
      state.focusIndex = -1;
    }
    
    // ===== ACHIEVEMENTS =====
    function renderAchievements() {
      const container = document.getElementById('achievements');
      container.innerHTML = state.achievements.slice(0, 6).map(a => 
        `<span class="achievement" title="${a.name}: ${a.desc}">${a.icon}</span>`
      ).join('');
    }
    
    // ===== STATS DASHBOARD =====
    function renderStatsDashboard() {
      return `
        <div class="stat-card">
          <div class="stat-value">${state.stats.totalProjects || 0}</div>
          <div class="stat-label">Projects</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${state.stats.totalFeatures || 0}</div>
          <div class="stat-label">Features</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${state.stats.totalUpdates || 0}</div>
          <div class="stat-label">Updates</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${(state.stats.allTags || []).length}</div>
          <div class="stat-label">Tags</div>
        </div>
      `;
    }
    
    // ===== ALL PROJECTS =====
    function renderAllProjects() {
      document.getElementById('statsDashboard').innerHTML = renderStatsDashboard();
      
      const container = document.getElementById('projectsGrid');
      const query = state.searchQuery.toLowerCase();
      
      container.innerHTML = Object.entries(state.projects).map(([key, proj]) => {
        const matchesSearch = !query || 
          proj.title.toLowerCase().includes(query) ||
          proj.desc.toLowerCase().includes(query) ||
          proj.features.some(f => 
            f.title.toLowerCase().includes(query) ||
            f.desc.toLowerCase().includes(query) ||
            f.tags.some(t => t.toLowerCase().includes(query))
          );
        
        const crossLink = state.crossLinks.find(l => l.from === key || l.to === key);
        
        return `
          <div class="project-card ${matchesSearch ? (query ? 'highlight' : '') : 'dimmed'}" 
               onclick="navigateToView('project', '${key}')" tabindex="0" data-key="${key}">
            <div class="project-card-title">${proj.icon} ${proj.title}</div>
            <div class="project-card-desc">${proj.desc || 'No description'}</div>
            <div class="project-card-stats">
              <span class="stat">üìã ${proj.features.length} features</span>
              <span class="stat">üìÖ ${proj.created}</span>
              <span class="stat">v${proj.version}</span>
            </div>
            ${crossLink ? `
              <div class="cross-links">
                üîó Connected via: ${crossLink.keywords.map(k => `<span class="cross-link-tag">${k}</span>`).join('')}
              </div>
            ` : ''}
          </div>
        `;
      }).join('');
    }
    
    // ===== PROJECT VIEW =====
    function renderProject(key) {
      const proj = state.projects[key];
      if (!proj) return;
      
      const query = state.searchQuery.toLowerCase();
      const progressPercent = Math.min(100, Math.round((proj.features.length / (proj.targetFeatures || 10)) * 100));
      
      const container = document.getElementById('projectView');
      container.innerHTML = `
        <div class="project-header">
          <div class="project-title">
            ${proj.icon} ${proj.title}
            <span class="version-badge">v${proj.version}</span>
          </div>
          <div class="project-desc">${proj.desc || ''}</div>
          <div class="project-meta">
            <span>üìÖ Created ${proj.created}</span>
            <span>üìù ${proj.history.length} updates</span>
          </div>
        </div>
        
        <div class="progress-container">
          <div class="progress-header">
            <span class="progress-label">Feature Progress</span>
            <span class="progress-value">${proj.features.length}/${proj.targetFeatures || 10} (${progressPercent}%)</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${progressPercent}%"></div>
          </div>
        </div>
        
        <div class="tree">
          ${proj.features.map((f, i) => {
            const matchesSearch = !query ||
              f.title.toLowerCase().includes(query) ||
              f.desc.toLowerCase().includes(query) ||
              f.tags.some(t => t.toLowerCase().includes(query));
            
            const notes = getNotes(key, f.title);
            const highlightTags = f.tags.map(t => 
              query && t.toLowerCase().includes(query) ? 'highlight' : ''
            );
            
            return `
              <div class="feature-card ${matchesSearch ? (query ? 'highlight' : '') : 'dimmed'}" 
                   tabindex="0" data-index="${i}" data-project="${key}" data-feature="${f.title}"
                   onclick="openFeatureModal('${key}', ${i})">
                ${notes.length ? '<span class="feature-note-indicator">üí¨</span>' : ''}
                <div class="feature-title">
                  <span class="feature-icon">${f.icon}</span>
                  ${highlightMatch(f.title, query)}
                </div>
                <div class="feature-desc">${highlightMatch(f.desc, query)}</div>
                <div class="feature-tags">
                  ${f.tags.map((t, ti) => `<span class="tag ${highlightTags[ti]}">${t}</span>`).join('')}
                </div>
                <div class="feature-date">Added ${f.added}</div>
              </div>
            `;
          }).join('')}
        </div>
        
        <div class="history-section" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
          <div style="font-size: 0.85em; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;">üìú Version History</div>
          ${proj.history.slice().reverse().map(h => `
            <div style="display: flex; gap: 12px; margin-bottom: 12px; font-size: 0.85em;">
              <span style="background: rgba(255,255,255,0.1); color: #aaa; padding: 2px 8px; border-radius: 6px; font-weight: 500; white-space: nowrap;">v${h.version}</span>
              <span style="color: var(--text-muted); white-space: nowrap;">${h.date}</span>
              <span style="color: var(--text-secondary);">${h.changes}</span>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    // ===== TIMELINE VIEW =====
    function renderTimeline() {
      const container = document.getElementById('timelineView');
      const query = state.searchQuery.toLowerCase();
      
      // Group features by date
      const byDate = {};
      state.allFeatures.forEach(f => {
        const date = f.date || f.added || 'Unknown';
        if (!byDate[date]) byDate[date] = [];
        byDate[date].push(f);
      });
      
      // Sort dates descending
      const dates = Object.keys(byDate).sort().reverse();
      
      container.innerHTML = dates.map(date => {
        const features = byDate[date];
        return `
          <div class="timeline-date">${date}</div>
          ${features.map(f => {
            const matchesSearch = !query ||
              f.title.toLowerCase().includes(query) ||
              f.desc.toLowerCase().includes(query);
            
            const proj = state.projects[f.project];
            return `
              <div class="timeline-item ${matchesSearch ? '' : 'dimmed'}">
                <div class="timeline-project">${proj ? proj.icon : 'üìÅ'} ${proj ? proj.title : f.project}</div>
                <div class="timeline-title">${highlightMatch(f.title, query)}</div>
                <div class="timeline-desc">${highlightMatch(f.desc || '', query)}</div>
              </div>
            `;
          }).join('')}
        `;
      }).join('');
    }
    
    // ===== CASES =====
    const DEFAULT_CASES = [
      { id: 'claude-billing', name: 'Claude Billing', icon: 'üí∞', desc: 'CLI tool to track Claude API spending from OpenClaw sessions.', created: '2026-02-06',
        features: ['SQLite database for billing data', 'Syncs from OpenClaw session files', 'Global CLI command', 'Cost breakdown by session'] },
      { id: 'openclaw-desktop', name: 'OpenClaw Desktop', icon: 'üñ•Ô∏è', desc: 'macOS menu bar app to run OpenClaw gateway in background.', created: '2026-02-06',
        features: ['Tray icon with status', 'Gateway start/stop/restart', 'Settings UI', 'Dark mode', 'Stats tab', 'Model selector (v2.0)'] },
      { id: 'detective-wall', name: 'Detective Wall', icon: 'üîç', desc: 'Visual case board for tracking projects ‚Äî the original version with Christmas tree layout.', created: '2026-02-06',
        features: ['Christmas tree layout', 'Red string connections', 'Search', 'Timeline view', 'PWA installable', 'WebSocket live updates'] },
      { id: 'bud-love-tickets', name: 'Bud Love Tickets', icon: 'üíú', desc: 'Ticket management app for collaborating with your AI assistant.', created: '2026-02-06',
        features: ['Kanban board (To Do / Doing / Done)', 'Cloud storage via JSONBlob', 'Vercel hosting', 'Case categories', 'Edit & delete tickets', 'Move buttons for mobile'] },
      { id: 'mcp', name: 'MCP', icon: 'üîå', desc: 'Model Context Protocol tools, servers, and integrations.', created: '2026-02-07',
        features: ['MCP Client Library', 'Multi-server orchestration', 'Magic MCP integration', 'mcporter CLI', 'OpenClaw MCP skill'] }
    ];
    
    function getCases() {
      const saved = localStorage.getItem('bud-love-cases');
      return saved ? JSON.parse(saved) : DEFAULT_CASES;
    }
    
    function saveCases(cases) {
      localStorage.setItem('bud-love-cases', JSON.stringify(cases));
    }
    
    function formatDate(dateStr) {
      if (!dateStr) return '';
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const parts = dateStr.split('-');
      if (parts.length !== 3) return dateStr;
      const month = months[parseInt(parts[1]) - 1];
      const day = parseInt(parts[2]);
      return `${month}.${day} ${parts[0]}`;
    }
    
    function renderCases() {
      const cases = getCases();
      const container = document.getElementById('casesList');
      
      container.innerHTML = `
        <div class="cases-table-header">
          <span class="col-name">Name</span>
          <span class="col-desc">Description</span>
          <span class="col-date">Created</span>
          <span class="col-tickets">Tickets</span>
        </div>
        ${cases.map(c => {
          const caseTickets = tickets.filter(t => {
            const cat = (t.category || '').toLowerCase();
            return cat === c.id.toLowerCase() || cat === c.name.toLowerCase();
          });
          return `
            <div class="case-row" onclick="viewCaseDetail('${c.id}')">
              <span class="col-name">${c.icon} ${c.name}</span>
              <span class="col-desc">${c.desc}</span>
              <span class="col-date">${formatDate(c.created)}</span>
              <span class="col-tickets"><span class="case-card-tickets">${caseTickets.length}</span></span>
            </div>
          `;
        }).join('')}
      `;
    }
    
    function filterByCase(caseId) {
      state.currentFilter = caseId;
      navigateToView('tickets');
    }
    
    function viewCaseDetail(caseId) {
      navigateToView('caseDetail', caseId);
    }
    
    function renderCaseDetail(caseId) {
      const cases = getCases();
      const c = cases.find(cs => cs.id === caseId);
      if (!c) return;
      
      const caseTickets = tickets.filter(t => {
        const cat = (t.category || '').toLowerCase();
        return cat === caseId.toLowerCase() || cat === c.name.toLowerCase();
      });
      const features = c.features || [];
      
      const container = document.getElementById('caseDetailContent');
      container.innerHTML = `
        <div class="case-detail-header">
          <div class="case-detail-title">${c.icon} ${c.name}</div>
          <div class="case-detail-desc">${c.desc}</div>
          <div style="color: var(--text-muted); font-size: 0.85em;">Created: ${c.created}</div>
        </div>
        
        ${features.length > 0 ? `
        <div class="case-features">
          <h3>‚ú® Features</h3>
          ${features.map(f => `<div class="feature-item">${f}</div>`).join('')}
        </div>
        ` : ''}
        
        <button class="case-create-btn" onclick="addTicketForCase('${caseId}')">
          üé´ Create Ticket for ${c.name}
        </button>
        
        ${caseTickets.length > 0 ? `
        <div class="case-tickets-section">
          <h3>üé´ Tickets (${caseTickets.length})</h3>
          ${caseTickets.map(t => `
            <div class="feature-item" style="display:flex; justify-content:space-between; align-items:center;">
              <span>${t.title}</span>
              <span class="kanban-card-priority priority-${t.priority}" style="font-size:0.7em; padding:2px 6px; border-radius:4px;">${t.status}</span>
            </div>
          `).join('')}
        </div>
        ` : ''}
      `;
    }
    
    function addTicketForCase(caseId) {
      addTicket('todo');
      // Set the category to this case
      setTimeout(() => {
        document.getElementById('ticketCategory').value = caseId;
      }, 100);
    }
    
    function updateCategoryDropdown() {
      const select = document.getElementById('ticketCategory');
      const cases = getCases();
      select.innerHTML = '<option value="general">üåê General</option>' +
        cases.map(c => `<option value="${c.id}">${c.icon} ${c.name}</option>`).join('');
    }
    
    // ===== TICKETS / KANBAN =====
    let tickets = [];
    let ideas = [];
    const TICKETS_API = '/api/tickets';
    
    const SEED_IDEAS = [
      { id: 'idea-seed-1', title: 'MCP Playground', desc: 'Visual web app to explore, test, and chain MCP servers. Like Postman meets Zapier for MCP. Server browser, tool tester, workflow builder.', category: 'MCP', status: 'planned', tags: ['mcp', 'webapp', 'tool'], created: '2026-02-07',
        plan: [
          { name: 'Phase 1: Server Explorer', desc: 'Connect to any MCP server and browse its tools', done: false },
          { name: 'Phase 2: Tool Tester', desc: 'Run any tool interactively with auto-generated forms', done: false },
          { name: 'Phase 3: Multi-Server + Workflow', desc: 'Connect multiple servers, chain tools, visual canvas', done: false },
          { name: 'Phase 4: Community', desc: 'Share workflows, preset library, featured gallery', done: false }
        ],
        notes: '' },
      { id: 'idea-seed-2', title: 'Vibe Board', desc: 'Describe a mood in words and it generates a complete design system ‚Äî colors, fonts, components. AI-powered design generation.', category: 'UI', status: 'brainstorming', tags: ['design', 'ai', 'creative'], created: '2026-02-07', plan: [], notes: '' },
      { id: 'idea-seed-3', title: 'Pulse Dashboard', desc: 'Personal command center connecting Discord, GitHub, tickets, calendar into one live dashboard. Mission control for your digital life.', category: 'Tool', status: 'brainstorming', tags: ['dashboard', 'integration'], created: '2026-02-07', plan: [], notes: '' }
    ];

    async function saveTicketsRemote() {
      try {
        await fetch(TICKETS_API, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tickets, ideas })
        });
        console.log('Data saved!');
      } catch (e) {
        console.error('Failed to save:', e);
      }
    }
    
    async function loadTickets() {
      try {
        const res = await fetch(TICKETS_API);
        const data = await res.json();
        tickets = data.tickets || [];
        ideas = data.ideas || [];
        // Seed ideas if none exist
        if (ideas.length === 0) {
          ideas = [...SEED_IDEAS];
          saveTicketsRemote();
        }
        // Ensure all ideas have plan and notes fields
        ideas.forEach(idea => {
          if (!idea.plan) idea.plan = [];
          if (typeof idea.notes !== 'string') idea.notes = '';
        });
        console.log('Loaded tickets:', tickets.length, 'ideas:', ideas.length);
        if (state.currentView === 'tickets') renderTickets();
        if (state.currentView === 'ideas') renderIdeas();
      } catch (e) {
        console.error('Failed to load tickets:', e);
        tickets = [];
        ideas = [...SEED_IDEAS];
      }
    }
    
    function getTicketShortId(id) {
      return 'BLT-' + (id || '0').slice(-4);
    }
    
    function getTicketAvatar(t) {
      // Determine avatar initials and color
      if (t.category && t.category.toLowerCase().includes('skyx')) return { initials: 'SK', color: '#a855f7' };
      if (t.createdBy === 'bot' || t.createdBy === 'bud') return { initials: 'BL', color: '#a855f7' };
      return { initials: 'SK', color: '#a855f7' };
    }
    
    function getCategoryLabel(categoryId) {
      if (!categoryId || categoryId === 'general') return 'üåê General';
      const cases = getCases();
      const c = cases.find(cs => cs.id === categoryId);
      return c ? `${c.icon} ${c.name}` : categoryId;
    }
    
    function formatTicketDate(dateStr) {
      if (!dateStr) return '';
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const parts = dateStr.split('-');
      if (parts.length !== 3) return dateStr;
      return `${months[parseInt(parts[1]) - 1]} ${parseInt(parts[2])}`;
    }
    
    function toggleCardMenu(e, id) {
      e.stopPropagation();
      // Close any open menus
      document.querySelectorAll('.card-menu-dropdown.active').forEach(m => m.classList.remove('active'));
      const menu = document.getElementById('menu-' + id);
      if (menu) menu.classList.add('active');
      
      // Close on next click anywhere
      const closeMenu = () => {
        menu && menu.classList.remove('active');
        document.removeEventListener('click', closeMenu);
      };
      setTimeout(() => document.addEventListener('click', closeMenu), 0);
    }
    
    function renderTickets() {
      const statuses = ['todo', 'doing', 'done'];
      statuses.forEach(status => {
        const container = document.getElementById(status + 'Cards');
        const count = document.getElementById(status + 'Count');
        const filtered = tickets.filter(t => t.status === status);
        count.textContent = filtered.length;
        
        // Build "X completed" label for done column
        const doneLabel = (status === 'done' && filtered.length > 0)
          ? `<div class="done-completed-label">${filtered.length} completed</div>`
          : '';
        
        container.innerHTML = doneLabel + filtered.map(t => {
          const prevStatus = status === 'doing' ? 'todo' : (status === 'done' ? 'doing' : null);
          const nextStatus = status === 'todo' ? 'doing' : (status === 'doing' ? 'done' : null);
          const shortId = getTicketShortId(t.id);
          const avatar = getTicketAvatar(t);
          const catLabel = getCategoryLabel(t.category);
          const dateStr = formatTicketDate(t.created);
          
          return `
          <div class="kanban-card" draggable="true" data-id="${t.id}" 
               ondragstart="dragStart(event)" ondragend="dragEnd(event)">
            <div class="kanban-card-top">
              <div class="kanban-card-top-left">
                <span class="kanban-card-id">${shortId}</span>
                ${t.priority ? `<span class="kanban-card-priority priority-${t.priority}">${t.priority}</span>` : ''}
              </div>
              <button class="kanban-card-menu" onclick="toggleCardMenu(event, '${t.id}')" title="Menu">‚ãØ</button>
            </div>
            <div class="card-menu-dropdown" id="menu-${t.id}">
              <button class="card-menu-item" onclick="event.stopPropagation(); editTicket('${t.id}')">‚úèÔ∏è Edit</button>
              ${prevStatus ? `<button class="card-menu-item" onclick="event.stopPropagation(); moveTicket('${t.id}', '${prevStatus}')">‚óÄ Move back</button>` : ''}
              ${nextStatus ? `<button class="card-menu-item" onclick="event.stopPropagation(); moveTicket('${t.id}', '${nextStatus}')">‚ñ∂ Move forward</button>` : ''}
              <button class="card-menu-item danger" onclick="event.stopPropagation(); deleteTicket('${t.id}')">üóëÔ∏è Delete</button>
            </div>
            <div class="kanban-card-title" onclick="editTicket('${t.id}')" style="cursor:pointer;">${t.title}</div>
            ${t.desc ? `<div class="kanban-card-desc">${t.desc}</div>` : ''}
            ${t.category && t.category !== 'general' ? `<span class="kanban-card-category">${catLabel}</span>` : ''}
            <div class="kanban-card-footer">
              <div class="kanban-card-footer-left">
                <div class="kanban-card-move">
                  ${prevStatus ? `<button class="move-btn" onclick="event.stopPropagation(); moveTicket('${t.id}', '${prevStatus}')" title="Move left">‚óÄ</button>` : ''}
                  ${nextStatus ? `<button class="move-btn" onclick="event.stopPropagation(); moveTicket('${t.id}', '${nextStatus}')" title="Move right">‚ñ∂</button>` : ''}
                </div>
                ${dateStr ? `<span class="kanban-card-footer-item">üïê ${dateStr}</span>` : ''}
              </div>
              <div class="kanban-card-avatar" style="background:${avatar.color}">${avatar.initials}</div>
            </div>
          </div>
        `}).join('');
      });
      
      // Setup drop zones
      document.querySelectorAll('.kanban-cards').forEach(zone => {
        zone.ondragover = e => { e.preventDefault(); zone.classList.add('drop-zone'); };
        zone.ondragleave = () => zone.classList.remove('drop-zone');
        zone.ondrop = e => dropTicket(e, zone);
      });
      
      // Setup mobile touch drag
      initTouchDrag();
    }
    
    let draggedId = null;
    let touchStartY = 0;
    let touchedCard = null;
    
    function dragStart(e) {
      draggedId = e.target.dataset.id;
      e.target.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }
    
    function dragEnd(e) {
      e.target.classList.remove('dragging');
    }
    
    async function dropTicket(e, zone) {
      e.preventDefault();
      zone.classList.remove('drop-zone');
      const newStatus = zone.closest('.kanban-column').dataset.status;
      
      if (draggedId) {
        const ticket = tickets.find(t => t.id === draggedId);
        if (ticket) {
          ticket.status = newStatus;
          saveTicketsRemote();
          renderTickets();
        }
        draggedId = null;
      }
    }
    
    // Mobile touch drag support - simpler approach with status buttons
    function initTouchDrag() {
      // Touch drag is complex on mobile - using move buttons instead
    }
    
    function addTicket(status) {
      document.getElementById('ticketStatus').value = status;
      document.getElementById('ticketTitle').value = '';
      document.getElementById('ticketDesc').value = '';
      document.getElementById('ticketCategory').value = 'general';
      document.querySelectorAll('.priority-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('.priority-btn[data-priority="medium"]').classList.add('active');
      document.getElementById('ticketForm').dataset.editId = '';
      document.querySelector('.modal-title').textContent = 'üé´ New Ticket';
      document.querySelector('.submit-btn').textContent = 'Create Ticket';
      updateCategoryDropdown();
      document.getElementById('ticketModalOverlay').style.display = 'flex';
      document.getElementById('ticketTitle').focus();
    }
    
    function closeTicketModal() {
      document.getElementById('ticketModalOverlay').style.display = 'none';
      document.getElementById('ticketForm').dataset.editId = '';
    }
    
    async function submitTicket(e) {
      e.preventDefault();
      const form = document.getElementById('ticketForm');
      const editId = form.dataset.editId;
      const title = document.getElementById('ticketTitle').value;
      const desc = document.getElementById('ticketDesc').value;
      const status = document.getElementById('ticketStatus').value;
      const priority = document.querySelector('.priority-btn.active').dataset.priority;
      const category = document.getElementById('ticketCategory').value;
      
      if (editId) {
        // Update existing
        const ticket = tickets.find(t => t.id === editId);
        if (ticket) {
          ticket.title = title;
          ticket.desc = desc;
          ticket.status = status;
          ticket.priority = priority;
          ticket.category = category;
        }
      } else {
        // Create new
        tickets.push({
          id: Date.now().toString(),
          title,
          desc,
          status,
          priority,
          category,
          created: new Date().toISOString().split('T')[0]
        });
      }
      
      saveTicketsRemote();
      renderTickets();
      closeTicketModal();
    }
    
    // Priority toggle handlers
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.priority-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.priority-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        });
      });
      
      // Close modal on overlay click
      document.getElementById('ticketModalOverlay').addEventListener('click', (e) => {
        if (e.target.id === 'ticketModalOverlay') closeTicketModal();
      });
    });
    
    async function deleteTicket(id) {
      if (confirm('Delete this ticket?')) {
        tickets = tickets.filter(t => t.id !== id);
        saveTicketsRemote();
        renderTickets();
      }
    }
    
    async function moveTicket(id, newStatus) {
      const ticket = tickets.find(t => t.id === id);
      if (ticket) {
        ticket.status = newStatus;
        saveTicketsRemote();
        renderTickets();
      }
    }
    
    function shareWithBud() {
      const doingTickets = tickets.filter(t => t.status === 'doing');
      if (doingTickets.length === 0) {
        showToast('üìã No tickets in Doing!');
        return;
      }
      
      const message = 'üé´ do the tickets:\n' + doingTickets.map(t => 
        `‚Ä¢ ${t.title}${t.desc ? ' - ' + t.desc : ''}`
      ).join('\n');
      
      navigator.clipboard.writeText(message).then(() => {
        showToast('üíú Copied! Paste in Discord to send to Bud');
      }).catch(() => {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = message;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        showToast('üíú Copied! Paste in Discord to send to Bud');
      });
    }
    
    function editTicket(id) {
      const ticket = tickets.find(t => t.id === id);
      if (!ticket) return;
      
      document.getElementById('ticketStatus').value = ticket.status;
      document.getElementById('ticketTitle').value = ticket.title;
      document.getElementById('ticketDesc').value = ticket.desc || '';
      document.querySelectorAll('.priority-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.priority === ticket.priority);
      });
      
      // Store editing ID
      document.getElementById('ticketForm').dataset.editId = id;
      document.querySelector('.modal-title').textContent = '‚úèÔ∏è Edit Ticket';
      document.querySelector('.submit-btn').textContent = 'Save Changes';
      document.getElementById('ticketModalOverlay').style.display = 'flex';
      document.getElementById('ticketTitle').focus();
    }
    
    async function letsDoIt() {
      console.log('letsDoIt called, tickets:', tickets);
      const todoTickets = tickets.filter(t => t.status === 'todo');
      console.log('Todo tickets:', todoTickets.length);
      
      if (todoTickets.length === 0) {
        showToast('üìã No tasks in To Do!');
        return;
      }
      
      // Move all to doing
      for (const t of todoTickets) {
        await fetch(`/api/tickets/${t.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: 'doing' })
        });
      }
      
      showToast('üöÄ Moved ' + todoTickets.length + ' task(s) to Doing!');
    }
    
    // Load tickets on startup
    loadTickets();

    // ===== IDEAS =====
    let ideasFilter = 'all';
    let ideasSortMode = 'time-desc';
    const statusOrder = { brainstorming: 0, planned: 1, building: 2, shipped: 3 };

    function changeIdeaSort(mode) {
      ideasSortMode = mode;
      renderIdeas();
    }

    function sortIdeas(list) {
      return list.slice().sort((a, b) => {
        switch (ideasSortMode) {
          case 'time-desc': return (b.createdAt || b.id || '0').localeCompare(a.createdAt || a.id || '0');
          case 'time-asc': return (a.createdAt || a.id || '0').localeCompare(b.createdAt || b.id || '0');
          case 'title-asc': return (a.title || '').localeCompare(b.title || '');
          case 'title-desc': return (b.title || '').localeCompare(a.title || '');
          case 'status': return (statusOrder[a.status] ?? 9) - (statusOrder[b.status] ?? 9);
          default: return 0;
        }
      });
    }

    function formatIdeaTime(idea) {
      if (idea.createdAt) {
        try {
          const d = new Date(idea.createdAt);
          if (!isNaN(d)) {
            const pad = n => String(n).padStart(2, '0');
            return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
          }
        } catch {}
      }
      return idea.created || '';
    }
    let expandedIdeaId = null;
    let activeIdeaInnerTab = {}; // { ideaId: 'description' | 'plan' | 'notes' }
    let notesDebounceTimers = {};

    const IDEA_STATUS_LABELS = {
      brainstorming: 'üí≠ Brainstorming',
      planned: 'üìã Planned',
      building: 'üî® Building',
      shipped: 'üöÄ Shipped'
    };

    function getIdeaInnerTab(id) {
      return activeIdeaInnerTab[id] || 'description';
    }

    function setIdeaInnerTab(id, tab, e) {
      if (e) e.stopPropagation();
      activeIdeaInnerTab[id] = tab;
      renderIdeas();
    }

    function renderPlanTab(idea) {
      const phases = idea.plan || [];
      const phasesHtml = phases.map((p, i) => `
        <div class="plan-phase ${p.done ? 'done' : ''}">
          <input type="checkbox" class="plan-phase-check" ${p.done ? 'checked' : ''}
            onchange="togglePhase('${idea.id}', ${i}, this.checked)">
          <div class="plan-phase-content">
            <div class="plan-phase-name" onclick="editPhaseName('${idea.id}', ${i}, this, event)">${escHtml(p.name)}</div>
            <div class="plan-phase-desc" onclick="editPhaseDesc('${idea.id}', ${i}, this, event)">${escHtml(p.desc) || '<span style="color:var(--text-muted);font-style:italic;">Add description...</span>'}</div>
          </div>
          <button class="plan-phase-delete" onclick="deletePhase('${idea.id}', ${i}, event)" title="Delete phase">‚úï</button>
        </div>
      `).join('');

      return `
        <div class="plan-phases">${phasesHtml}</div>
        ${phases.length === 0 ? '<div style="color:var(--text-muted);font-size:0.82em;padding:12px 0;">No phases yet. Add one to start planning!</div>' : ''}
        <button class="plan-add-btn" onclick="addPhase('${idea.id}', event)">+ Add Phase</button>
      `;
    }

    function renderNotesTab(idea) {
      return `
        <textarea class="idea-notes-area" id="idea-notes-${idea.id}"
          placeholder="Jot down thoughts, links, references..."
          oninput="debounceSaveNotes('${idea.id}')">${escHtml(idea.notes || '')}</textarea>
        <div class="idea-notes-saved" id="idea-notes-saved-${idea.id}">‚úì Saved</div>
      `;
    }

    function renderDescriptionTab(idea) {
      return `
        <div style="color:var(--text-secondary);font-size:0.88em;line-height:1.6;margin-bottom:14px;">${idea.desc || '<span style="color:var(--text-muted);font-style:italic;">No description</span>'}</div>
        <div class="idea-inline-edit" style="display:block;" onclick="event.stopPropagation()">
          <div class="form-group">
            <label>Title</label>
            <input type="text" id="inline-idea-title-${idea.id}" value="${(idea.title || '').replace(/"/g, '&quot;')}">
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea rows="4" id="inline-idea-desc-${idea.id}">${escHtml(idea.desc || '')}</textarea>
          </div>
          <div class="form-group">
            <label>Category</label>
            <input type="text" id="inline-idea-cat-${idea.id}" value="${(idea.category || '').replace(/"/g, '&quot;')}">
          </div>
          <div class="form-group">
            <label>Tags (comma separated)</label>
            <input type="text" id="inline-idea-tags-${idea.id}" value="${(idea.tags || []).join(', ')}">
          </div>
          <div class="form-group">
            <label>Status</label>
            <select id="inline-idea-status-${idea.id}" class="idea-status-select">
              <option value="brainstorming" ${idea.status === 'brainstorming' ? 'selected' : ''}>üí≠ Brainstorming</option>
              <option value="planned" ${idea.status === 'planned' ? 'selected' : ''}>üìã Planned</option>
              <option value="building" ${idea.status === 'building' ? 'selected' : ''}>üî® Building</option>
              <option value="shipped" ${idea.status === 'shipped' ? 'selected' : ''}>üöÄ Shipped</option>
            </select>
          </div>
          <button class="idea-save-btn" onclick="saveInlineIdea('${idea.id}')">Save</button>
          <button class="idea-cancel-btn" onclick="expandedIdeaId=null; renderIdeas();">Collapse</button>
        </div>
      `;
    }

    function escHtml(str) {
      if (!str) return '';
      return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }

    function renderIdeas() {
      const container = document.getElementById('ideasGrid');
      const filtered = sortIdeas(ideasFilter === 'all' ? ideas : ideas.filter(i => i.status === ideasFilter));

      if (filtered.length === 0) {
        container.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--text-muted);">No ideas yet${ideasFilter !== 'all' ? ' with this status' : ''}. Spark one! ‚ú®</div>`;
        return;
      }

      container.innerHTML = filtered.map(idea => {
        const isExpanded = expandedIdeaId === idea.id;
        const innerTab = getIdeaInnerTab(idea.id);
        const planCount = (idea.plan || []).length;
        const planDone = (idea.plan || []).filter(p => p.done).length;

        let innerTabContent = '';
        if (isExpanded) {
          if (innerTab === 'plan') innerTabContent = renderPlanTab(idea);
          else if (innerTab === 'notes') innerTabContent = renderNotesTab(idea);
          else innerTabContent = renderDescriptionTab(idea);
        }

        const catColors = { MCP:'168,85,247', Creative:'236,72,153', Productivity:'45,212,191', Tool:'249,115,22', UI:'99,102,241' };
        const catColor = catColors[idea.category] || '168,85,247';
        const catEmojis = { MCP:'üîå', Creative:'üé®', Productivity:'‚ö°', Tool:'üõ†Ô∏è', UI:'üñåÔ∏è' };
        const heroEmoji = catEmojis[idea.category] || 'üí°';
        const progressPct = planCount > 0 ? Math.round((planDone / planCount) * 100) : 0;

        return `
          <div class="idea-card ${isExpanded ? 'expanded' : ''}" data-id="${idea.id}" onclick="toggleIdeaExpand('${idea.id}', event)" style="--card-accent:${catColor};">
            <div class="idea-card-accent" style="background:linear-gradient(135deg, rgba(${catColor},0.3), rgba(${catColor},0.05));"></div>
            <div class="idea-card-top">
              <span class="idea-status-badge idea-status-${idea.status}">${IDEA_STATUS_LABELS[idea.status] || idea.status}</span>
              <button class="idea-card-menu" onclick="toggleIdeaMenu(event, '${idea.id}')" title="Menu">‚ãØ</button>
            </div>
            <div class="idea-menu-dropdown" id="idea-menu-${idea.id}">
              <button class="card-menu-item" onclick="event.stopPropagation(); openEditIdeaModal('${idea.id}')">‚úèÔ∏è Edit</button>
              <button class="card-menu-item danger" onclick="event.stopPropagation(); deleteIdea('${idea.id}')">üóëÔ∏è Delete</button>
            </div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px;">
              <span style="font-size:1.6em;line-height:1;">${heroEmoji}</span>
              <div class="idea-card-title" style="margin-bottom:0;">${idea.title}</div>
            </div>
            ${!isExpanded ? `
              <div class="idea-card-desc">${idea.desc || ''}</div>
            ` : ''}
            ${planCount > 0 && !isExpanded ? `
              <div style="margin:8px 0;">
                <div style="display:flex;justify-content:space-between;font-size:0.75em;color:var(--text-muted);margin-bottom:3px;">
                  <span>${planDone}/${planCount} phases</span>
                  <span>${progressPct}%</span>
                </div>
                <div style="height:4px;background:rgba(255,255,255,0.06);border-radius:4px;overflow:hidden;">
                  <div style="height:100%;width:${progressPct}%;background:linear-gradient(90deg,rgba(${catColor},0.8),rgba(${catColor},0.5));border-radius:4px;transition:width 0.3s;"></div>
                </div>
              </div>
            ` : ''}
            <div class="idea-card-tags">
              ${(idea.tags || []).map(t => `<span class="idea-tag">${t}</span>`).join('')}
            </div>
            ${!isExpanded ? `
              <div class="idea-card-footer">
                <span class="idea-card-category" style="border-color:rgba(${catColor},0.3);color:rgba(${catColor},1);">${idea.category || 'Uncategorized'}</span>
                <span>${formatIdeaTime(idea)}</span>
              </div>
            ` : ''}
            ${isExpanded ? `
              <div onclick="event.stopPropagation()">
                <div class="idea-inner-tabs">
                  <button class="idea-inner-tab ${innerTab === 'description' ? 'active' : ''}" onclick="setIdeaInnerTab('${idea.id}', 'description', event)">üìù Description</button>
                  <button class="idea-inner-tab ${innerTab === 'plan' ? 'active' : ''}" onclick="setIdeaInnerTab('${idea.id}', 'plan', event)">üìã Plan${planCount > 0 ? ' (' + planDone + '/' + planCount + ')' : ''}</button>
                  <button class="idea-inner-tab ${innerTab === 'notes' ? 'active' : ''}" onclick="setIdeaInnerTab('${idea.id}', 'notes', event)">üí¨ Notes${idea.notes ? ' ‚Ä¢' : ''}</button>
                </div>
                <div class="idea-tab-content">
                  ${innerTabContent}
                </div>
                <div class="idea-card-footer" style="margin-top:12px;">
                  <span class="idea-card-category">${idea.category || 'Uncategorized'}</span>
                  <span>${formatIdeaTime(idea)}</span>
                </div>
              </div>
            ` : ''}
          </div>
        `;
      }).join('');
    }

    // ===== PLAN FUNCTIONS =====
    function togglePhase(ideaId, phaseIndex, checked) {
      const idea = ideas.find(i => i.id === ideaId);
      if (!idea || !idea.plan || !idea.plan[phaseIndex]) return;
      idea.plan[phaseIndex].done = checked;
      saveTicketsRemote();
      renderIdeas();
    }

    function deletePhase(ideaId, phaseIndex, e) {
      if (e) e.stopPropagation();
      const idea = ideas.find(i => i.id === ideaId);
      if (!idea || !idea.plan) return;
      idea.plan.splice(phaseIndex, 1);
      saveTicketsRemote();
      renderIdeas();
    }

    function addPhase(ideaId, e) {
      if (e) e.stopPropagation();
      const idea = ideas.find(i => i.id === ideaId);
      if (!idea) return;
      if (!idea.plan) idea.plan = [];
      idea.plan.push({ name: 'New Phase', desc: '', done: false });
      saveTicketsRemote();
      renderIdeas();
    }

    function editPhaseName(ideaId, phaseIndex, el, e) {
      if (e) e.stopPropagation();
      const idea = ideas.find(i => i.id === ideaId);
      if (!idea || !idea.plan || !idea.plan[phaseIndex]) return;
      const phase = idea.plan[phaseIndex];
      const currentText = phase.name;
      el.innerHTML = `<input type="text" class="plan-phase-edit-input" value="${currentText.replace(/"/g, '&quot;')}" 
        onblur="savePhaseField('${ideaId}', ${phaseIndex}, 'name', this.value)"
        onkeydown="if(event.key==='Enter'){this.blur();}if(event.key==='Escape'){this.value='${currentText.replace(/'/g, "\\'")}';this.blur();}">`;
      const input = el.querySelector('input');
      input.focus();
      input.select();
    }

    function editPhaseDesc(ideaId, phaseIndex, el, e) {
      if (e) e.stopPropagation();
      const idea = ideas.find(i => i.id === ideaId);
      if (!idea || !idea.plan || !idea.plan[phaseIndex]) return;
      const phase = idea.plan[phaseIndex];
      const currentText = phase.desc || '';
      el.innerHTML = `<input type="text" class="plan-phase-edit-input" value="${currentText.replace(/"/g, '&quot;')}" placeholder="Add description..."
        onblur="savePhaseField('${ideaId}', ${phaseIndex}, 'desc', this.value)"
        onkeydown="if(event.key==='Enter'){this.blur();}if(event.key==='Escape'){this.value='${currentText.replace(/'/g, "\\'")}';this.blur();}">`;
      const input = el.querySelector('input');
      input.focus();
      input.select();
    }

    function savePhaseField(ideaId, phaseIndex, field, value) {
      const idea = ideas.find(i => i.id === ideaId);
      if (!idea || !idea.plan || !idea.plan[phaseIndex]) return;
      idea.plan[phaseIndex][field] = value.trim();
      saveTicketsRemote();
      renderIdeas();
    }

    // ===== NOTES AUTO-SAVE =====
    function debounceSaveNotes(ideaId) {
      if (notesDebounceTimers[ideaId]) clearTimeout(notesDebounceTimers[ideaId]);
      notesDebounceTimers[ideaId] = setTimeout(() => {
        const textarea = document.getElementById('idea-notes-' + ideaId);
        if (!textarea) return;
        const idea = ideas.find(i => i.id === ideaId);
        if (!idea) return;
        idea.notes = textarea.value;
        saveTicketsRemote();
        // Show saved indicator
        const saved = document.getElementById('idea-notes-saved-' + ideaId);
        if (saved) {
          saved.classList.add('visible');
          setTimeout(() => saved.classList.remove('visible'), 2000);
        }
      }, 800);
    }

    function toggleIdeaExpand(id, e) {
      // Don't expand if clicking menu or dropdown
      if (e.target.closest('.idea-card-menu') || e.target.closest('.idea-menu-dropdown') || e.target.closest('.idea-inline-edit') || e.target.closest('.idea-inner-tabs') || e.target.closest('.idea-tab-content')) return;
      if (expandedIdeaId === id) {
        expandedIdeaId = null;
      } else {
        expandedIdeaId = id;
        if (!activeIdeaInnerTab[id]) activeIdeaInnerTab[id] = 'description';
      }
      renderIdeas();
    }

    function toggleIdeaMenu(e, id) {
      e.stopPropagation();
      document.querySelectorAll('.idea-menu-dropdown.active').forEach(m => m.classList.remove('active'));
      const menu = document.getElementById('idea-menu-' + id);
      if (menu) menu.classList.add('active');
      const closeMenu = () => {
        menu && menu.classList.remove('active');
        document.removeEventListener('click', closeMenu);
      };
      setTimeout(() => document.addEventListener('click', closeMenu), 0);
    }

    function saveInlineIdea(id) {
      const idea = ideas.find(i => i.id === id);
      if (!idea) return;
      idea.title = document.getElementById('inline-idea-title-' + id).value.trim();
      idea.desc = document.getElementById('inline-idea-desc-' + id).value.trim();
      idea.category = document.getElementById('inline-idea-cat-' + id).value.trim();
      idea.tags = document.getElementById('inline-idea-tags-' + id).value.split(',').map(t => t.trim()).filter(Boolean);
      idea.status = document.getElementById('inline-idea-status-' + id).value;
      saveTicketsRemote();
      expandedIdeaId = null;
      renderIdeas();
      showToast('üí° Idea updated!');
    }

    function openNewIdeaModal() {
      document.getElementById('ideaEditId').value = '';
      document.getElementById('ideaTitle').value = '';
      document.getElementById('ideaDesc').value = '';
      document.getElementById('ideaCategory').value = '';
      document.getElementById('ideaTags').value = '';
      document.getElementById('ideaStatus').value = 'brainstorming';
      document.getElementById('ideaModalTitle').textContent = 'üí° New Idea';
      document.querySelector('#ideaForm .submit-btn').textContent = 'Create Idea';
      document.getElementById('ideaModalOverlay').style.display = 'flex';
      document.getElementById('ideaTitle').focus();
    }

    function openEditIdeaModal(id) {
      const idea = ideas.find(i => i.id === id);
      if (!idea) return;
      document.getElementById('ideaEditId').value = id;
      document.getElementById('ideaTitle').value = idea.title;
      document.getElementById('ideaDesc').value = idea.desc || '';
      document.getElementById('ideaCategory').value = idea.category || '';
      document.getElementById('ideaTags').value = (idea.tags || []).join(', ');
      document.getElementById('ideaStatus').value = idea.status || 'brainstorming';
      document.getElementById('ideaModalTitle').textContent = '‚úèÔ∏è Edit Idea';
      document.querySelector('#ideaForm .submit-btn').textContent = 'Save Changes';
      document.getElementById('ideaModalOverlay').style.display = 'flex';
      document.getElementById('ideaTitle').focus();
    }

    function closeIdeaModal() {
      document.getElementById('ideaModalOverlay').style.display = 'none';
    }

    function submitIdea(e) {
      e.preventDefault();
      const editId = document.getElementById('ideaEditId').value;
      const title = document.getElementById('ideaTitle').value.trim();
      const desc = document.getElementById('ideaDesc').value.trim();
      const category = document.getElementById('ideaCategory').value.trim();
      const tags = document.getElementById('ideaTags').value.split(',').map(t => t.trim()).filter(Boolean);
      const status = document.getElementById('ideaStatus').value;

      if (editId) {
        const idea = ideas.find(i => i.id === editId);
        if (idea) {
          idea.title = title;
          idea.desc = desc;
          idea.category = category;
          idea.tags = tags;
          idea.status = status;
        }
      } else {
        ideas.push({
          id: 'idea-' + Date.now().toString(),
          title,
          desc,
          category,
          status,
          tags,
          created: new Date().toISOString().split('T')[0],
          createdAt: new Date().toISOString()
        });
      }

      saveTicketsRemote();
      renderIdeas();
      closeIdeaModal();
      showToast(editId ? 'üí° Idea updated!' : 'üí° Idea created!');
    }

    function deleteIdea(id) {
      if (confirm('Delete this idea?')) {
        ideas = ideas.filter(i => i.id !== id);
        if (expandedIdeaId === id) expandedIdeaId = null;
        saveTicketsRemote();
        renderIdeas();
        showToast('üóëÔ∏è Idea deleted');
      }
    }

    // Ideas filter click handlers
    document.getElementById('ideasFilters').addEventListener('click', (e) => {
      const btn = e.target.closest('.idea-filter-btn');
      if (!btn) return;
      ideasFilter = btn.dataset.filter;
      document.querySelectorAll('.idea-filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      expandedIdeaId = null;
      renderIdeas();
    });

    // Close idea modal on overlay click
    document.getElementById('ideaModalOverlay').addEventListener('click', (e) => {
      if (e.target.id === 'ideaModalOverlay') closeIdeaModal();
    });

    // ===== SEARCH =====
    function highlightMatch(text, query) {
      if (!query || !text) return text;
      const regex = new RegExp(`(${query})`, 'gi');
      return text.replace(regex, '<mark style="background: rgba(255,215,0,0.4); color: inherit; padding: 0 2px; border-radius: 2px;">$1</mark>');
    }
    
    document.getElementById('searchInput').addEventListener('input', (e) => {
      state.searchQuery = e.target.value;
      updateURL();
      
      // Re-render current view
      if (state.currentView === 'all') {
        renderAllProjects();
      } else if (state.currentView === 'timeline') {
        renderTimeline();
      } else if (state.currentView === 'tickets') {
        renderTickets();
      } else if (state.currentView === 'ideas') {
        renderIdeas();
      } else if (state.currentView === 'project') {
        renderProject(state.currentProject);
      }
    });
    
    // ===== NOTES/COMMENTS =====
    function getNotes(project, feature) {
      const key = `detective-notes-${project}-${feature}`;
      try {
        return JSON.parse(localStorage.getItem(key) || '[]');
      } catch {
        return [];
      }
    }
    
    function saveNote(project, feature, text) {
      const key = `detective-notes-${project}-${feature}`;
      const notes = getNotes(project, feature);
      notes.push({
        text,
        date: new Date().toISOString()
      });
      localStorage.setItem(key, JSON.stringify(notes));
      return notes;
    }
    
    // ===== MODAL =====
    function openFeatureModal(projectKey, featureIndex) {
      const proj = state.projects[projectKey];
      if (!proj) return;
      
      const feature = proj.features[featureIndex];
      if (!feature) return;
      
      const notes = getNotes(projectKey, feature.title);
      
      document.getElementById('modalTitle').innerHTML = `${feature.icon} ${feature.title}`;
      document.getElementById('modalBody').innerHTML = `
        <div class="modal-section">
          <div class="modal-section-title">Description</div>
          <div class="modal-desc">${feature.desc}</div>
        </div>
        <div class="modal-section">
          <div class="modal-section-title">Tags</div>
          <div class="feature-tags">
            ${feature.tags.map(t => `<span class="tag">${t}</span>`).join('')}
          </div>
        </div>
        <div class="modal-section">
          <div class="modal-section-title">Added</div>
          <div class="modal-desc">${feature.added}</div>
        </div>
        <div class="notes-section">
          <div class="modal-section-title">üí¨ Notes</div>
          <div class="notes-list">
            ${notes.map(n => `
              <div class="note-item">
                <div class="note-text">${n.text}</div>
                <div class="note-date">${new Date(n.date).toLocaleString()}</div>
              </div>
            `).join('') || '<div style="color: var(--text-muted); font-size: 0.85em;">No notes yet</div>'}
          </div>
          <textarea class="note-input" id="noteInput" placeholder="Add a note..."></textarea>
          <button class="note-submit" onclick="submitNote('${projectKey}', '${feature.title}')">Add Note</button>
        </div>
      `;
      
      document.getElementById('modalOverlay').classList.add('active');
    }
    
    function submitNote(projectKey, featureTitle) {
      const input = document.getElementById('noteInput');
      const text = input.value.trim();
      if (!text) return;
      
      saveNote(projectKey, featureTitle, text);
      input.value = '';
      showToast('üí¨ Note added!');
      
      // Re-render to show indicator
      if (state.currentView === 'project') {
        renderProject(state.currentProject);
      }
      
      // Refresh modal
      const proj = state.projects[projectKey];
      const featureIndex = proj.features.findIndex(f => f.title === featureTitle);
      openFeatureModal(projectKey, featureIndex);
    }
    
    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('active');
    }
    
    document.getElementById('modalClose').addEventListener('click', closeModal);
    document.getElementById('modalOverlay').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) closeModal();
    });
    
    // ===== KEYBOARD NAVIGATION =====
    document.addEventListener('keydown', (e) => {
      // `/` to focus search
      if (e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
        e.preventDefault();
        document.getElementById('searchInput').focus();
        return;
      }
      
      // Escape to close modal or blur search
      if (e.key === 'Escape') {
        if (document.getElementById('modalOverlay').classList.contains('active')) {
          closeModal();
        } else {
          document.getElementById('searchInput').blur();
          state.searchQuery = '';
          document.getElementById('searchInput').value = '';
          updateURL();
          if (state.currentView === 'all') renderAllProjects();
          else if (state.currentView === 'project') renderProject(state.currentProject);
          else if (state.currentView === 'timeline') renderTimeline();
        }
        return;
      }
      
      // Arrow navigation
      if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
        e.preventDefault();
        const cards = document.querySelectorAll('.feature-card:not(.dimmed), .project-card:not(.dimmed)');
        if (cards.length === 0) return;
        
        if (e.key === 'ArrowDown') {
          state.focusIndex = Math.min(state.focusIndex + 1, cards.length - 1);
        } else {
          state.focusIndex = Math.max(state.focusIndex - 1, 0);
        }
        
        cards[state.focusIndex]?.focus();
      }
      
      // Enter to open/select
      if (e.key === 'Enter' && document.activeElement.classList.contains('feature-card')) {
        const project = document.activeElement.dataset.project;
        const index = parseInt(document.activeElement.dataset.index);
        openFeatureModal(project, index);
      }
      
      if (e.key === 'Enter' && document.activeElement.classList.contains('project-card')) {
        const key = document.activeElement.dataset.key;
        navigateToView('project', key);
      }
    });
    
    // ===== TOAST =====
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }
    
    // ===== INIT =====
    loadData();
    connectWebSocket();
  </script>
</body>
</html>
